<!DOCTYPE html>
<html lang="hi" data-theme="light">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>‡§ï‡§æ‡§µ‡•ç‡§Ø-‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§ï ‚Äî Hindi & Marathi Poem Analyzer</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,600&family=DM+Sans:wght@300;400;500;600&family=Tiro+Devanagari+Hindi&display=swap" rel="stylesheet"/>
<style>
*{margin:0;padding:0;box-sizing:border-box}

[data-theme="light"]{
  --bg:#F8F3EA;
  --bg2:#F2EAD8;
  --surface:#FFFFFF;
  --surface2:#FAF6EE;
  --surface3:#F5EFE2;
  --border:rgba(160,110,40,0.15);
  --border2:rgba(160,110,40,0.28);
  --border3:rgba(160,110,40,0.45);
  --ink:#1A0E00;
  --ink2:#5C3D10;
  --ink3:rgba(90,55,10,0.45);
  --ink4:rgba(90,55,10,0.28);
  --saffron:#D4450A;
  --saffron-glow:rgba(212,69,10,0.18);
  --gold:#A87020;
  --gold2:#C89030;
  --gold-glow:rgba(168,112,32,0.12);
  --cream:#EDE0C4;
  --shadow:0 2px 20px rgba(100,60,0,0.10);
  --shadow2:0 8px 40px rgba(100,60,0,0.12);
  --shadow3:0 24px 80px rgba(100,60,0,0.14);
  --correct:#1A7A40;
  --nav-bg:rgba(248,243,234,0.88);
  --card-gradient:linear-gradient(145deg,#FFFFFF,#FAF6EE);
  --hero-gradient:linear-gradient(180deg,#F8F3EA 0%,#EDE0C4 100%);
}

[data-theme="dark"]{
  --bg:#0D0905;
  --bg2:#130F08;
  --surface:#1C150C;
  --surface2:#221A10;
  --surface3:#2A2015;
  --border:rgba(160,110,40,0.14);
  --border2:rgba(160,110,40,0.24);
  --border3:rgba(160,110,40,0.38);
  --ink:#F0E4CC;
  --ink2:#C8A060;
  --ink3:rgba(200,160,80,0.5);
  --ink4:rgba(200,160,80,0.28);
  --saffron:#F06030;
  --saffron-glow:rgba(240,96,48,0.2);
  --gold:#C89030;
  --gold2:#E0A840;
  --gold-glow:rgba(200,144,48,0.15);
  --cream:#2C2010;
  --shadow:0 2px 20px rgba(0,0,0,0.4);
  --shadow2:0 8px 40px rgba(0,0,0,0.5);
  --shadow3:0 24px 80px rgba(0,0,0,0.6);
  --correct:#2ECC71;
  --nav-bg:rgba(13,9,5,0.92);
  --card-gradient:linear-gradient(145deg,#1C150C,#221A10);
  --hero-gradient:linear-gradient(180deg,#0D0905 0%,#1C150C 100%);
}

html{scroll-behavior:smooth}
body{
  background:var(--bg);
  color:var(--ink);
  font-family:'DM Sans','Helvetica Neue',sans-serif;
  min-height:100vh;
  overflow-x:hidden;
  transition:background 0.4s,color 0.4s;
  -webkit-font-smoothing:antialiased;
}

/* ‚îÄ‚îÄ NOISE TEXTURE OVERLAY ‚îÄ‚îÄ */
body::after{
  content:'';
  position:fixed;inset:0;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.025'/%3E%3C/svg%3E");
  pointer-events:none;z-index:9999;
}

/* ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ */
.nav{
  position:fixed;top:0;left:0;right:0;z-index:500;
  height:60px;
  background:var(--nav-bg);
  backdrop-filter:blur(20px) saturate(180%);
  -webkit-backdrop-filter:blur(20px) saturate(180%);
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;
  padding:0 24px;gap:12px;
}
.nav-left{flex:1;display:flex;align-items:center;gap:10px;}
.nav-logo{font-family:'Cormorant Garamond',serif;font-size:1.1rem;font-weight:700;color:var(--gold);letter-spacing:1px;display:none;}
.nav-right{display:flex;align-items:center;gap:6px;}

.nav-btn{
  height:34px;
  padding:0 14px;
  background:transparent;
  border:1px solid var(--border2);
  border-radius:6px;
  color:var(--ink2);
  font-family:'DM Sans',sans-serif;
  font-size:0.78rem;
  font-weight:500;
  cursor:pointer;
  display:flex;align-items:center;gap:6px;
  transition:all 0.2s;
  white-space:nowrap;
  letter-spacing:0.3px;
}
.nav-btn:hover{background:var(--surface2);border-color:var(--border3);color:var(--gold);}
.nav-btn.active{background:var(--saffron);border-color:var(--saffron);color:white;}
.nav-btn svg{width:13px;height:13px;opacity:0.8;}

.recents-pill{
  height:34px;padding:0 14px;
  background:var(--surface2);
  border:1px solid var(--border2);
  border-radius:6px;
  color:var(--ink2);
  font-family:'DM Sans',sans-serif;
  font-size:0.78rem;font-weight:600;
  cursor:pointer;
  display:flex;align-items:center;gap:8px;
  transition:all 0.2s;
}
.recents-pill:hover{border-color:var(--gold);color:var(--gold);}
.recents-pill-count{
  background:var(--saffron);color:white;
  border-radius:10px;padding:1px 7px;
  font-size:0.68rem;font-weight:700;
  min-width:20px;text-align:center;
}

/* ‚îÄ‚îÄ DRAWER ‚îÄ‚îÄ */
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:600;opacity:0;pointer-events:none;transition:opacity 0.3s;backdrop-filter:blur(4px);}
.overlay.open{opacity:1;pointer-events:all;}
.drawer{
  position:fixed;top:0;left:0;height:100%;width:360px;max-width:92vw;
  background:var(--bg);z-index:700;
  transform:translateX(-100%);
  transition:transform 0.38s cubic-bezier(0.32,0,0.15,1);
  display:flex;flex-direction:column;
  border-right:1px solid var(--border2);
}
.drawer.open{transform:translateX(0);}
.drawer-top{
  padding:20px 22px 16px;
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;
  background:var(--surface2);
}
.drawer-heading{
  font-family:'Cormorant Garamond',serif;
  font-size:1.15rem;font-weight:700;
  color:var(--gold);
  display:flex;align-items:center;gap:8px;
}
.drawer-close{
  width:32px;height:32px;border-radius:6px;
  background:transparent;border:1px solid var(--border2);
  cursor:pointer;color:var(--ink2);font-size:1rem;
  display:flex;align-items:center;justify-content:center;
  transition:all 0.2s;
}
.drawer-close:hover{background:var(--saffron);color:white;border-color:var(--saffron);}
.drawer-toolbar{padding:10px 18px;border-bottom:1px solid var(--border);display:flex;justify-content:flex-end;}
.drawer-clear{font-size:0.75rem;color:var(--ink3);background:none;border:1px solid var(--border);border-radius:5px;padding:5px 11px;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all 0.2s;}
.drawer-clear:hover{color:var(--saffron);border-color:var(--saffron);}
.drawer-body{flex:1;overflow-y:auto;padding:14px;}
.drawer-empty{text-align:center;padding:48px 16px;color:var(--ink3);font-size:0.85rem;font-style:italic;line-height:1.8;}

.r-item{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:10px;
  padding:14px 16px;
  cursor:pointer;
  display:flex;align-items:center;gap:10px;
  margin-bottom:8px;
  transition:all 0.22s;
}
.r-item:hover{border-color:var(--gold2);transform:translateX(3px);box-shadow:var(--shadow);}
.r-item-info{flex:1;min-width:0;}
.r-item-title{font-family:'Cormorant Garamond',serif;font-size:0.95rem;font-weight:700;color:var(--ink);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.r-item-meta{font-size:0.71rem;color:var(--ink3);margin-top:2px;}
.r-badge{font-size:0.6rem;padding:2px 7px;border-radius:4px;font-weight:700;letter-spacing:0.8px;text-transform:uppercase;flex-shrink:0;}
.r-badge-hi{background:var(--saffron-glow);border:1px solid var(--saffron);color:var(--saffron);}
.r-badge-mr{background:var(--gold-glow);border:1px solid var(--gold);color:var(--gold);}
.r-arrow{color:var(--gold2);font-size:1rem;opacity:0.6;}

/* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
.hero{
  min-height:100vh;
  background:var(--hero-gradient);
  display:flex;flex-direction:column;
  align-items:center;justify-content:center;
  padding:80px 24px 60px;
  text-align:center;
  position:relative;
  overflow:hidden;
}

/* Decorative mandala rings */
.hero::before{
  content:'';
  position:absolute;
  width:700px;height:700px;
  border-radius:50%;
  border:1px solid var(--border);
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  pointer-events:none;
  animation:pulse-ring 6s ease-in-out infinite;
}
.hero::after{
  content:'';
  position:absolute;
  width:500px;height:500px;
  border-radius:50%;
  border:1px solid var(--border2);
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  pointer-events:none;
  animation:pulse-ring 6s ease-in-out infinite 1s;
}
@keyframes pulse-ring{
  0%,100%{opacity:0.4;transform:translate(-50%,-50%) scale(1);}
  50%{opacity:0.8;transform:translate(-50%,-50%) scale(1.03);}
}

.hero-lamp{
  font-size:3rem;
  display:block;
  margin-bottom:20px;
  position:relative;z-index:1;
  animation:float 4s ease-in-out infinite;
  filter:drop-shadow(0 8px 24px var(--saffron-glow));
}
@keyframes float{0%,100%{transform:translateY(0) rotate(-2deg)}50%{transform:translateY(-10px) rotate(2deg)}}

.hero-eyebrow{
  font-family:'DM Sans',sans-serif;
  font-size:0.7rem;
  font-weight:600;
  letter-spacing:5px;
  text-transform:uppercase;
  color:var(--gold);
  margin-bottom:16px;
  position:relative;z-index:1;
  display:flex;align-items:center;gap:12px;
}
.hero-eyebrow::before,.hero-eyebrow::after{content:'';width:32px;height:1px;background:var(--gold);opacity:0.5;}

.hero-title{
  font-family:'Cormorant Garamond',serif;
  font-size:clamp(3rem,8vw,5.5rem);
  font-weight:700;
  line-height:1.0;
  color:var(--ink);
  letter-spacing:-0.5px;
  margin-bottom:12px;
  position:relative;z-index:1;
}
.hero-title em{
  color:var(--saffron);
  font-style:italic;
}

.hero-sub{
  font-size:0.85rem;
  color:var(--ink3);
  letter-spacing:3px;
  text-transform:uppercase;
  font-weight:500;
  margin-bottom:48px;
  position:relative;z-index:1;
}

/* ‚îÄ‚îÄ SCROLL CUE ‚îÄ‚îÄ */
.scroll-cue{
  position:relative;z-index:1;
  display:flex;flex-direction:column;align-items:center;gap:8px;
  color:var(--ink4);font-size:0.72rem;letter-spacing:2px;text-transform:uppercase;
  animation:bounce-down 2s ease-in-out infinite;
  cursor:pointer;
}
.scroll-cue svg{width:18px;height:18px;}
@keyframes bounce-down{0%,100%{transform:translateY(0);opacity:0.5;}50%{transform:translateY(6px);opacity:1;}}

/* ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ */
main{max-width:860px;margin:0 auto;padding:60px 24px 100px;}

/* ‚îÄ‚îÄ INPUT CARD ‚îÄ‚îÄ */
.input-card{
  background:var(--card-gradient);
  border:1px solid var(--border2);
  border-radius:20px;
  padding:36px 36px 28px;
  margin-bottom:28px;
  box-shadow:var(--shadow3);
  position:relative;
  overflow:hidden;
}
.input-card::before{
  content:'';
  position:absolute;
  top:-1px;left:20%;right:20%;
  height:2px;
  background:linear-gradient(90deg,transparent,var(--gold),transparent);
}
.input-eyebrow{
  font-size:0.68rem;
  font-weight:600;
  letter-spacing:3px;
  text-transform:uppercase;
  color:var(--gold);
  margin-bottom:14px;
  display:flex;align-items:center;gap:8px;
}
.input-eyebrow::after{content:'';flex:1;height:1px;background:var(--border2);}

textarea{
  width:100%;
  min-height:190px;
  border:1px solid var(--border2);
  border-radius:12px;
  padding:18px 20px;
  font-family:'Tiro Devanagari Hindi','Georgia',serif;
  font-size:1.08rem;
  line-height:1.95;
  color:var(--ink);
  background:var(--surface);
  resize:vertical;
  outline:none;
  transition:border-color 0.25s,box-shadow 0.25s;
}
textarea:focus{
  border-color:var(--gold2);
  box-shadow:0 0 0 3px var(--gold-glow),var(--shadow);
}
textarea::placeholder{color:var(--ink4);font-style:italic;}

.btn-row{display:flex;gap:10px;margin-top:18px;flex-wrap:wrap;}

.btn-analyze{
  flex:1;min-width:200px;
  height:52px;
  background:linear-gradient(135deg,var(--saffron),#B83808);
  border:none;border-radius:12px;
  color:white;
  font-family:'DM Sans',sans-serif;
  font-size:0.95rem;font-weight:600;
  cursor:pointer;letter-spacing:0.3px;
  transition:all 0.25s;
  box-shadow:0 4px 0 rgba(100,20,0,0.35),0 8px 28px var(--saffron-glow);
  position:relative;top:0;
  display:flex;align-items:center;justify-content:center;gap:8px;
}
.btn-analyze:hover{top:-2px;box-shadow:0 6px 0 rgba(100,20,0,0.35),0 14px 36px var(--saffron-glow);}
.btn-analyze:active{top:2px;box-shadow:0 2px 0 rgba(100,20,0,0.35);}
.btn-analyze:disabled{background:var(--surface3);color:var(--ink3);box-shadow:none;cursor:not-allowed;top:0;}

.btn-refresh{
  display:none;
  align-items:center;justify-content:center;gap:7px;
  height:52px;padding:0 22px;
  background:transparent;
  border:1.5px solid var(--border3);
  border-radius:12px;
  color:var(--ink2);
  font-family:'DM Sans',sans-serif;
  font-size:0.88rem;font-weight:600;
  cursor:pointer;
  transition:all 0.2s;
}
.btn-refresh:hover{background:var(--surface2);border-color:var(--gold);color:var(--gold);}

/* ‚îÄ‚îÄ ERROR ‚îÄ‚îÄ */
.error{
  background:rgba(200,50,30,0.06);
  border:1px solid rgba(200,50,30,0.25);
  border-left:3px solid var(--saffron);
  border-radius:10px;
  padding:14px 18px;
  margin-bottom:24px;
  color:var(--saffron);
  font-size:0.86rem;
  display:none;
}

/* ‚îÄ‚îÄ RESULT TOOLBAR ‚îÄ‚îÄ */
.result-bar{
  display:flex;align-items:center;gap:8px;
  margin-bottom:20px;flex-wrap:wrap;
}
.result-bar-title{
  font-family:'Cormorant Garamond',serif;
  font-size:1.1rem;font-weight:600;
  color:var(--ink2);flex:1;
  font-style:italic;
}
.action-btn{
  height:32px;padding:0 12px;
  background:var(--surface);
  border:1px solid var(--border2);
  border-radius:6px;
  color:var(--ink3);
  font-family:'DM Sans',sans-serif;
  font-size:0.75rem;font-weight:600;
  cursor:pointer;
  display:flex;align-items:center;gap:5px;
  transition:all 0.2s;
  letter-spacing:0.3px;
}
.action-btn:hover{border-color:var(--gold2);color:var(--gold);background:var(--surface2);}
.action-btn.copied{background:var(--correct);border-color:var(--correct);color:white;}

/* ‚îÄ‚îÄ POEM HEADER CARD ‚îÄ‚îÄ */
.poem-header{
  background:var(--card-gradient);
  border:1px solid var(--border2);
  border-radius:18px;
  padding:28px 32px;
  margin-bottom:20px;
  display:flex;flex-wrap:wrap;gap:24px;align-items:flex-end;
  box-shadow:var(--shadow2);
  position:relative;overflow:hidden;
}
.poem-header::before{
  content:'';
  position:absolute;
  top:-1px;left:15%;right:15%;
  height:2px;
  background:linear-gradient(90deg,transparent,var(--gold2),transparent);
}
.ph-field{flex:1;min-width:140px;}
.ph-label{
  font-size:0.62rem;letter-spacing:3px;text-transform:uppercase;
  color:var(--gold);font-weight:600;margin-bottom:5px;
  font-family:'DM Sans',sans-serif;
}
.ph-value{
  font-family:'Cormorant Garamond',serif;
  font-size:1.3rem;font-weight:700;color:var(--ink);line-height:1.2;
}
.ph-value.sm{font-family:'DM Sans',sans-serif;font-size:0.95rem;font-weight:400;color:var(--ink2);}
.ph-badges{display:flex;gap:8px;flex-wrap:wrap;align-items:center;}
.badge{
  display:inline-flex;align-items:center;gap:4px;
  border-radius:6px;padding:5px 13px;
  font-size:0.68rem;letter-spacing:1.2px;
  text-transform:uppercase;font-weight:700;
  font-family:'DM Sans',sans-serif;
}
.badge-hi{background:var(--saffron-glow);border:1px solid var(--saffron);color:var(--saffron);}
.badge-mr{background:var(--gold-glow);border:1px solid var(--gold);color:var(--gold);}
.badge-mood{background:var(--surface3);border:1px solid var(--border2);color:var(--ink2);font-size:0.67rem;}

/* ‚îÄ‚îÄ BIO CARD ‚îÄ‚îÄ */
.bio-card{
  background:var(--card-gradient);
  border:1px solid var(--border);
  border-radius:18px;
  padding:24px 28px;
  margin-bottom:20px;
  display:flex;gap:22px;align-items:flex-start;
  box-shadow:var(--shadow);
}
.bio-photo{
  width:130px;height:130px;
  border-radius:12px;
  object-fit:cover;object-position:top center;
  border:2px solid var(--border2);
  flex-shrink:0;
}
.bio-placeholder{
  width:130px;height:130px;
  border-radius:12px;
  background:var(--surface3);
  border:1.5px dashed var(--border2);
  flex-shrink:0;
  display:flex;align-items:center;justify-content:center;
  font-size:2.8rem;
}
.bio-right{flex:1;}
.bio-name{font-family:'Cormorant Garamond',serif;font-size:1.15rem;font-weight:700;color:var(--ink);margin-bottom:8px;}
.bio-text{font-size:0.87rem;line-height:1.85;color:var(--ink2);}

/* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
.tabs-header{
  display:flex;
  background:var(--surface2);
  border:1px solid var(--border2);
  border-radius:14px 14px 0 0;
  overflow-x:auto;
  border-bottom:none;
}
.tab-btn{
  padding:14px 22px;
  border:none;background:none;
  font-family:'DM Sans',sans-serif;
  font-size:0.82rem;font-weight:500;
  color:var(--ink3);
  cursor:pointer;
  border-bottom:2px solid transparent;
  margin-bottom:-1px;
  white-space:nowrap;
  transition:all 0.2s;
  letter-spacing:0.3px;
}
.tab-btn:hover{color:var(--gold);}
.tab-btn.active{
  color:var(--saffron);
  border-bottom-color:var(--saffron);
  font-weight:700;
  background:var(--surface);
  border-radius:12px 12px 0 0;
}

.tab-body{
  background:var(--surface);
  border:1px solid var(--border2);
  border-top:none;
  border-radius:0 0 14px 14px;
  padding:32px;
  box-shadow:var(--shadow2);
  margin-bottom:28px;
}
.panel{display:none;}.panel.active{display:block;}
.panel-head{
  display:flex;align-items:center;justify-content:space-between;
  margin-bottom:22px;
  padding-bottom:14px;
  border-bottom:1px solid var(--border);
}
.panel-title{
  font-family:'Cormorant Garamond',serif;
  font-size:1.15rem;font-weight:700;
  color:var(--gold);
}
.panel-text{line-height:2.05;color:var(--ink);font-size:0.98rem;}
.panel-text p{margin-bottom:16px;}

/* ‚îÄ‚îÄ THEMES ‚îÄ‚îÄ */
.themes{display:flex;flex-wrap:wrap;gap:8px;margin-top:20px;}
.theme-tag{
  background:var(--surface3);
  border:1px solid var(--border2);
  border-radius:20px;
  padding:5px 16px;
  font-size:0.8rem;color:var(--gold);
  font-family:'DM Sans',sans-serif;font-weight:500;
}

/* ‚îÄ‚îÄ MESSAGE BLOCK ‚îÄ‚îÄ */
.msg-block{
  border-left:3px solid var(--saffron);
  padding:20px 24px;
  background:var(--surface2);
  border-radius:0 12px 12px 0;
  margin-top:4px;
}

/* ‚îÄ‚îÄ LITERARY DEVICES ‚îÄ‚îÄ */
.device{
  padding:14px 20px;
  margin-bottom:10px;
  background:var(--surface2);
  border-radius:10px;
  line-height:1.85;
  font-size:0.93rem;
  position:relative;
  padding-left:18px;
}
.device::before{
  content:'';
  position:absolute;left:0;top:12px;bottom:12px;
  width:3px;border-radius:3px;
}
.device:nth-child(odd)::before{background:var(--saffron);}
.device:nth-child(even)::before{background:var(--gold);}

/* ‚îÄ‚îÄ EXAM QUESTIONS ‚îÄ‚îÄ */
.question{
  background:var(--surface2);
  border:1px solid var(--border);
  border-radius:12px;
  padding:18px 20px;
  margin-bottom:12px;
}
.q-head{display:flex;gap:10px;align-items:flex-start;margin-bottom:10px;}
.q-type-badge{
  border-radius:5px;padding:3px 9px;
  font-size:0.6rem;letter-spacing:1px;text-transform:uppercase;
  font-weight:700;flex-shrink:0;margin-top:3px;
  font-family:'DM Sans',sans-serif;
}
.qt-sa{background:var(--gold-glow);border:1px solid var(--gold);color:var(--gold);}
.qt-la{background:var(--saffron-glow);border:1px solid var(--saffron);color:var(--saffron);}
.qt-mcq{background:rgba(26,122,64,0.1);border:1px solid var(--correct);color:var(--correct);}
.q-text{font-weight:600;line-height:1.65;font-size:0.93rem;}
.q-options{margin:10px 0 8px 18px;}
.q-option{padding:3px 0;font-size:0.88rem;color:var(--ink3);font-family:'DM Sans',sans-serif;}
.q-option.correct{color:var(--correct);font-weight:700;}
.q-hint{
  background:var(--bg);border:1px solid var(--border);
  border-radius:7px;padding:9px 13px;
  font-size:0.8rem;color:var(--gold);margin-top:8px;
  font-family:'DM Sans',sans-serif;
}

/* ‚îÄ‚îÄ SPINNER ‚îÄ‚îÄ */
.spinner{
  display:inline-block;width:15px;height:15px;
  border:2px solid rgba(255,255,255,0.35);
  border-top-color:white;border-radius:50%;
  animation:spin 0.7s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

/* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
footer{
  text-align:center;padding:36px 20px;
  color:var(--ink4);font-size:0.75rem;
  border-top:1px solid var(--border);
  font-family:'DM Sans',sans-serif;
  letter-spacing:0.5px;
}
footer strong{color:var(--gold);font-weight:600;}

/* ‚îÄ‚îÄ CHAT PANEL ‚îÄ‚îÄ */
.chat-messages{
  min-height:320px;
  max-height:420px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:16px;
  padding:4px 2px 12px;
  scroll-behavior:smooth;
}
.chat-welcome{
  text-align:center;
  padding:24px 16px 8px;
  animation:fadeIn 0.4s ease;
}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
.chat-welcome-icon{font-size:2.4rem;margin-bottom:10px;}
.chat-welcome-title{font-family:'Cormorant Garamond',serif;font-size:1.15rem;font-weight:700;color:var(--gold);margin-bottom:6px;}
.chat-welcome-sub{font-size:0.83rem;color:var(--ink3);line-height:1.7;max-width:380px;margin:0 auto 20px;}
.chat-suggestions{display:flex;flex-wrap:wrap;gap:8px;justify-content:center;}
.suggestion-chip{
  background:var(--surface2);
  border:1px solid var(--border2);
  border-radius:20px;
  padding:7px 14px;
  font-size:0.78rem;
  color:var(--ink2);
  font-family:'DM Sans',sans-serif;
  cursor:pointer;
  transition:all 0.2s;
  text-align:left;
  line-height:1.4;
}
.suggestion-chip:hover{background:var(--surface3);border-color:var(--gold2);color:var(--gold);}

/* Chat bubbles */
.chat-bubble{display:flex;gap:10px;animation:fadeIn 0.3s ease;}
.chat-bubble.user{flex-direction:row-reverse;}
.bubble-avatar{
  width:32px;height:32px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:0.9rem;flex-shrink:0;margin-top:2px;
}
.bubble-avatar.ai-av{background:linear-gradient(135deg,var(--saffron),#B83808);color:white;font-size:0.75rem;font-weight:700;}
.bubble-avatar.user-av{background:var(--surface3);border:1px solid var(--border2);font-size:1rem;}
.bubble-content{
  max-width:80%;
  padding:12px 16px;
  border-radius:14px;
  font-size:0.91rem;
  line-height:1.85;
  font-family:'Tiro Devanagari Hindi','Georgia',serif;
}
.chat-bubble.ai .bubble-content{
  background:var(--surface2);
  border:1px solid var(--border);
  border-bottom-left-radius:4px;
  color:var(--ink);
}
.chat-bubble.user .bubble-content{
  background:linear-gradient(135deg,var(--saffron),#B83808);
  color:white;
  border-bottom-right-radius:4px;
  font-family:'DM Sans',sans-serif;
}
.bubble-time{font-size:0.68rem;color:var(--ink4);margin-top:4px;font-family:'DM Sans',sans-serif;}
.chat-bubble.user .bubble-time{text-align:right;}

/* Typing indicator */
.typing-indicator{display:flex;gap:10px;align-items:center;animation:fadeIn 0.3s ease;}
.typing-dots{display:flex;gap:4px;padding:12px 16px;background:var(--surface2);border:1px solid var(--border);border-radius:14px;border-bottom-left-radius:4px;}
.typing-dot{width:7px;height:7px;border-radius:50%;background:var(--gold);opacity:0.4;}
.typing-dot:nth-child(1){animation:typing 1.2s 0s infinite;}
.typing-dot:nth-child(2){animation:typing 1.2s 0.2s infinite;}
.typing-dot:nth-child(3){animation:typing 1.2s 0.4s infinite;}
@keyframes typing{0%,60%,100%{opacity:0.4;transform:none;}30%{opacity:1;transform:translateY(-4px);}}

/* Chat input */
.chat-input-wrap{
  border-top:1px solid var(--border);
  padding-top:16px;
  margin-top:4px;
}
.chat-input-box{
  display:flex;
  align-items:flex-end;
  gap:10px;
  background:var(--surface2);
  border:1.5px solid var(--border2);
  border-radius:14px;
  padding:10px 10px 10px 16px;
  transition:border-color 0.2s,box-shadow 0.2s;
}
.chat-input-box:focus-within{
  border-color:var(--gold2);
  box-shadow:0 0 0 3px var(--gold-glow);
}
.chat-textarea{
  flex:1;
  border:none;
  background:transparent;
  font-family:'Tiro Devanagari Hindi','Georgia',serif;
  font-size:0.95rem;
  line-height:1.6;
  color:var(--ink);
  resize:none;
  outline:none;
  max-height:120px;
  min-height:24px;
  overflow-y:auto;
  padding:2px 0;
}
.chat-textarea::placeholder{color:var(--ink4);font-style:italic;font-size:0.88rem;}
.chat-send-btn{
  width:38px;height:38px;flex-shrink:0;
  background:linear-gradient(135deg,var(--saffron),#B83808);
  border:none;border-radius:10px;
  color:white;cursor:pointer;
  display:flex;align-items:center;justify-content:center;
  transition:all 0.2s;
  box-shadow:0 2px 8px var(--saffron-glow);
}
.chat-send-btn:hover{transform:scale(1.06);box-shadow:0 4px 16px var(--saffron-glow);}
.chat-send-btn:disabled{background:var(--surface3);color:var(--ink3);box-shadow:none;cursor:not-allowed;transform:none;}
.chat-hint{font-size:0.7rem;color:var(--ink4);margin-top:7px;text-align:center;font-family:'DM Sans',sans-serif;}

/* ‚îÄ‚îÄ PRINT ‚îÄ‚îÄ */
@media print{
  .nav,.overlay,.drawer,.btn-row,.result-bar,.action-btn,footer,body::after{display:none!important;}
  body{background:white!important;color:#000!important;}
  #result{display:block!important;}
  .panel{display:block!important;margin-bottom:20pt;}
  .tabs-header,.tab-btn{display:none!important;}
  .tab-body{border:none!important;padding:0!important;box-shadow:none!important;}
  main{padding:0!important;}
}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media(max-width:640px){
  .hero-title{font-size:2.8rem;}
  .input-card{padding:22px 18px 18px;}
  .tab-body{padding:20px 16px;}
  .poem-header{padding:20px 18px;}
  .btn-row{flex-direction:column;}
  .btn-refresh{justify-content:center;}
  .nav-logo{display:block;}
  .bio-card{flex-direction:column;align-items:center;text-align:center;}
  .bio-photo,.bio-placeholder{width:100px;height:100px;}
  .tab-btn{padding:12px 14px;font-size:0.78rem;}
}
</style>
</head>
<body>

<!-- NAV -->
<nav class="nav">
  <div class="nav-left">
    <button class="recents-pill" onclick="openDrawer()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
      Recents
      <span class="recents-pill-count" id="recentsCount">0</span>
    </button>
    <span class="nav-logo">‡§ï‡§æ‡§µ‡•ç‡§Ø-‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§ï</span>
  </div>
  <div class="nav-right">
    <button class="nav-btn" onclick="toggleDark()" id="darkBtn">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
      Dark
    </button>
    <button class="nav-btn" onclick="printPage()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
      Print
    </button>
    <button class="nav-btn" onclick="shareResult()" id="shareBtn">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
      Share
    </button>
  </div>
</nav>

<!-- DRAWER OVERLAY -->
<div class="overlay" id="overlay" onclick="closeDrawer()"></div>

<!-- RECENTS DRAWER -->
<div class="drawer" id="drawer">
  <div class="drawer-top">
    <div class="drawer-heading">
      <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
      Recent Analyses
    </div>
    <button class="drawer-close" onclick="closeDrawer()">‚úï</button>
  </div>
  <div class="drawer-toolbar">
    <button class="drawer-clear" onclick="clearRecents()">üóë Clear All</button>
  </div>
  <div class="drawer-body" id="drawerList"></div>
</div>

<!-- HERO -->
<section class="hero" id="heroSection">
  <span class="hero-lamp">ü™î</span>
  <div class="hero-eyebrow">AI-Powered Literary Analysis</div>
  <h1 class="hero-title">‡§ï‡§æ‡§µ‡•ç‡§Ø<em>-</em>‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§ï</h1>
  <p class="hero-sub">Hindi &amp; Marathi Poem Analyzer</p>
  <div class="scroll-cue" onclick="document.getElementById('analyzeSection').scrollIntoView({behavior:'smooth'})">
    <span>Begin</span>
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>
  </div>
</section>

<!-- MAIN -->
<main id="analyzeSection">

  <!-- INPUT -->
  <div class="input-card">
    <div class="input-eyebrow">‚úçÔ∏è Enter Your Poem</div>
    <textarea id="poem" placeholder="‡§Ø‡§π‡§æ‡§Å ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Ø‡§æ ‡§Æ‡§∞‡§æ‡§†‡•Ä ‡§ï‡§µ‡§ø‡§§‡§æ ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç...&#10;‡§á‡§•‡•á ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§ï‡§ø‡§Ç‡§µ‡§æ ‡§Æ‡§∞‡§æ‡§†‡•Ä ‡§ï‡§µ‡§ø‡§§‡§æ ‡§ü‡§æ‡§ï‡§æ..."></textarea>
    <div class="btn-row">
      <button class="btn-analyze" id="btn" onclick="analyze()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        ‡§ï‡§µ‡§ø‡§§‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡•á‡§Ç / ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡§æ
      </button>
      <button class="btn-refresh" id="refreshBtn" onclick="resetPage()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 .49-4.5"/></svg>
        Refresh
      </button>
    </div>
  </div>

  <div class="error" id="err"></div>

  <!-- RESULT -->
  <div id="result" style="display:none">

    <div class="result-bar">
      <span class="result-bar-title" id="r-toolbar-title"></span>
      <button class="action-btn" onclick="copyAll()" id="copyBtn">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
        Copy All
      </button>
      <button class="action-btn" onclick="printPage()">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
        Print / PDF
      </button>
      <button class="action-btn" onclick="shareResult()">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
        Share
      </button>
    </div>

    <!-- POEM HEADER -->
    <div class="poem-header">
      <div class="ph-field"><div class="ph-label">‡§ï‡§µ‡§ø‡§§‡§æ ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï</div><div class="ph-value" id="r-title"></div></div>
      <div class="ph-field"><div class="ph-label">‡§ï‡§µ‡•Ä / ‡§ï‡§µ‡§ø</div><div class="ph-value sm" id="r-poet"></div></div>
      <div class="ph-badges">
        <span class="badge" id="r-lang"></span>
        <span class="badge badge-mood" id="r-mood"></span>
      </div>
    </div>

    <!-- BIO -->
    <div class="bio-card" id="bioCard" style="display:none">
      <div id="bioPhotoWrap"></div>
      <div class="bio-right">
        <div class="bio-name" id="bio-name"></div>
        <div class="bio-text" id="bio-text"></div>
      </div>
    </div>

    <!-- TABS -->
    <div class="tabs-header">
      <button class="tab-btn active" onclick="tab('summary',this)">üìñ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂</button>
      <button class="tab-btn" onclick="tab('message',this)">üí° ‡§∏‡§Ç‡§¶‡•á‡§∂</button>
      <button class="tab-btn" onclick="tab('literary',this)">üé≠ ‡§ï‡§æ‡§µ‡•ç‡§Ø-‡§Ö‡§≤‡§Ç‡§ï‡§æ‡§∞</button>
      <button class="tab-btn" onclick="tab('exam',this)">üìù ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®</button>
      <button class="tab-btn" onclick="tab('chat',this)" id="chatTabBtn">üí¨ Ask AI</button>
    </div>

    <div class="tab-body">
      <div class="panel active" id="p-summary">
        <div class="panel-head">
          <div class="panel-title">üìñ ‡§ï‡§µ‡§ø‡§§‡§æ ‡§ï‡§æ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ / ‡§ï‡§µ‡§ø‡§§‡•á‡§ö‡§æ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂</div>
          <button class="action-btn" onclick="copyPanel('r-summary',event)">Copy</button>
        </div>
        <div class="panel-text" id="r-summary"></div>
        <div class="themes" id="r-themes"></div>
      </div>
      <div class="panel" id="p-message">
        <div class="panel-head">
          <div class="panel-title">üí° ‡§ï‡§µ‡§ø ‡§ï‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ / ‡§ï‡§µ‡•Ä‡§ö‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂</div>
          <button class="action-btn" onclick="copyPanel('r-message',event)">Copy</button>
        </div>
        <div class="msg-block panel-text" id="r-message"></div>
      </div>
      <div class="panel" id="p-literary">
        <div class="panel-head">
          <div class="panel-title">üé≠ ‡§ï‡§æ‡§µ‡•ç‡§Ø-‡§Ö‡§≤‡§Ç‡§ï‡§æ‡§∞ / Literary Devices</div>
        </div>
        <div id="r-devices"></div>
      </div>
      <div class="panel" id="p-exam">
        <div class="panel-head">
          <div class="panel-title">üìù ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®</div>
          <button class="action-btn" onclick="copyPanel('r-questions',event)">Copy</button>
        </div>
        <div id="r-questions"></div>
      </div>
      <!-- CHAT PANEL -->
      <div class="panel" id="p-chat">
        <div class="panel-head">
          <div class="panel-title">üí¨ ‡§ï‡§µ‡§ø‡§§‡§æ ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§™‡•Ç‡§õ‡•á‡§Ç / Ask About the Poem</div>
          <button class="action-btn" onclick="clearChat()">üóë Clear</button>
        </div>
        <!-- Chat Messages -->
        <div class="chat-messages" id="chatMessages">
          <div class="chat-welcome">
            <div class="chat-welcome-icon">ü§ñ</div>
            <div class="chat-welcome-title">AI Poetry Assistant</div>
            <div class="chat-welcome-sub">‡§ï‡§µ‡§ø‡§§‡§æ ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§õ ‡§≠‡•Ä ‡§™‡•Ç‡§õ‡•á‡§Ç ‚Äî ‡§Ö‡§∞‡•ç‡§•, ‡§≠‡§æ‡§µ, ‡§á‡§§‡§ø‡§π‡§æ‡§∏, ‡§Ø‡§æ ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®</div>
            <div class="chat-suggestions" id="chatSuggestions">
              <button class="suggestion-chip" onclick="sendSuggestion(this)">‡§á‡§∏ ‡§ï‡§µ‡§ø‡§§‡§æ ‡§ï‡§æ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?</button>
              <button class="suggestion-chip" onclick="sendSuggestion(this)">‡§ï‡§µ‡§ø ‡§®‡•á ‡§á‡§∏‡•á ‡§ï‡•ç‡§Ø‡•ã‡§Ç ‡§≤‡§ø‡§ñ‡§æ?</button>
              <button class="suggestion-chip" onclick="sendSuggestion(this)">‡§á‡§∏ ‡§ï‡§µ‡§ø‡§§‡§æ ‡§Æ‡•á‡§Ç ‡§ï‡•å‡§® ‡§∏‡•á ‡§Ö‡§≤‡§Ç‡§ï‡§æ‡§∞ ‡§π‡•à‡§Ç?</button>
              <button class="suggestion-chip" onclick="sendSuggestion(this)">Explain the first stanza in detail</button>
            </div>
          </div>
        </div>
        <!-- Chat Input -->
        <div class="chat-input-wrap">
          <div class="chat-input-box">
            <textarea class="chat-textarea" id="chatInput" placeholder="‡§ï‡§µ‡§ø‡§§‡§æ ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§Ö‡§™‡§®‡§æ ‡§™‡•ç‡§∞‡§∂‡•ç‡§® ‡§≤‡§ø‡§ñ‡•á‡§Ç... / Ask your question about the poem..." rows="1" onkeydown="handleChatKey(event)" oninput="autoResize(this)"></textarea>
            <button class="chat-send-btn" id="chatSendBtn" onclick="sendChat()">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
            </button>
          </div>
          <div class="chat-hint">Press Enter to send ¬∑ Shift+Enter for new line</div>
        </div>
      </div>
    </div>

  </div>
</main>

<footer>ü™î <strong>‡§ï‡§æ‡§µ‡•ç‡§Ø-‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§ï</strong> &nbsp;¬∑&nbsp; Hindi &amp; Marathi Poem Analyzer &nbsp;¬∑&nbsp; Powered by Google Gemini &amp; Cloudflare</footer>

<script>
const MAX_RECENTS = 10;
let currentResult = null;

const PROMPT = `You are an expert literary scholar specializing in Hindi and Marathi poetry.
Analyze the poem and respond ONLY with raw valid JSON (no markdown, no backticks, no extra text):
{
  "title": "poem title or ‡§Ö‡§ú‡•ç‡§û‡§æ‡§§",
  "poet": "Carefully identify the poet by analyzing style, language, themes and signature clues. Search your knowledge for well-known poems. Provide exact poet name if known, else ‡§Ö‡§ú‡•ç‡§û‡§æ‡§§ ‡§ï‡§µ‡•Ä",
  "language": "Hindi or Marathi",
  "summary": "Write a detailed summary in 3-4 full paragraphs in the same language as the poem. Each paragraph must be 4-5 sentences. Cover meaning of each stanza, emotions, imagery, and overall flow. Separate paragraphs with newline.",
  "poetMessage": "Write a detailed explanation in 3-4 full paragraphs in the same language as the poem. Each paragraph 4-5 sentences. Explain deeper philosophical/social message, context, and relevance today. Separate paragraphs with newline.",
  "poetBio": "Write a 3-4 sentence biography of the poet in the SAME language as the poem (Hindi or Marathi). Include birth/death years, major works, literary style, and contribution to literature. If the poem is in Marathi write bio in Marathi. If the poem is in Hindi write bio in Hindi. If poet is unknown write N/A.",
  "poetNameEnglish": "The poet's name written in English/Roman script for Wikipedia search. Example: Kusumagraj, Kabir Das, Mirabai. If unknown write N/A.",
  "themes": ["theme1","theme2","theme3"],
  "literaryDevices": ["‡§Ö‡§≤‡§Ç‡§ï‡§æ‡§∞ name: explanation","‡§Ö‡§≤‡§Ç‡§ï‡§æ‡§∞ name: explanation","‡§Ö‡§≤‡§Ç‡§ï‡§æ‡§∞ name: explanation"],
  "mood": "emotional tone in 2-3 words",
  "examQuestions": [
    {"type":"Short Answer","question":"question text","hint":"brief hint"},
    {"type":"Long Answer","question":"question text","hint":"brief hint"},
    {"type":"MCQ","question":"question text","options":["A) option","B) option","C) option","D) option"],"answer":"A"},
    {"type":"Short Answer","question":"question text","hint":"brief hint"},
    {"type":"Long Answer","question":"question text","hint":"brief hint"},
    {"type":"MCQ","question":"question text","options":["A) option","B) option","C) option","D) option"],"answer":"B"}
  ]
}`;

// ‚îÄ‚îÄ DARK MODE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleDark() {
  const html = document.documentElement;
  const isDark = html.getAttribute('data-theme') === 'dark';
  html.setAttribute('data-theme', isDark ? 'light' : 'dark');
  const btn = document.getElementById('darkBtn');
  btn.innerHTML = isDark
    ? `<svg viewBox="0 0 24 24" width="13" height="13" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg> Dark`
    : `<svg viewBox="0 0 24 24" width="13" height="13" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg> Light`;
  btn.classList.toggle('active', !isDark);
  localStorage.setItem('kavya_theme', isDark ? 'light' : 'dark');
}

// ‚îÄ‚îÄ PRINT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function printPage() {
  if (!currentResult) { alert('Please analyze a poem first.'); return; }
  const r = currentResult;
  const themes = (r.themes||[]).map(t=>`<span style="display:inline-block;background:#f5e6c8;border:1px solid #C8860A;border-radius:20px;padding:4px 14px;font-size:0.8rem;color:#A87020;margin:3px">${t}</span>`).join('');
  const summary = (r.summary||'').split('\n').filter(p=>p.trim()).map(p=>`<p style="margin-bottom:14px;line-height:2.05">${p}</p>`).join('');
  const message = (r.poetMessage||'').split('\n').filter(p=>p.trim()).map(p=>`<p style="margin-bottom:14px;line-height:2.05;font-style:italic">${p}</p>`).join('');
  const devices = (r.literaryDevices||[]).map((d,i)=>`<div style="padding:12px 18px 12px 20px;margin-bottom:8px;background:#faf6ee;border-left:3px solid ${i%2===0?'#D4450A':'#A87020'};border-radius:0 8px 8px 0;font-size:0.92rem;line-height:1.8">${d}</div>`).join('');
  const questions = (r.examQuestions||[]).map((q,i)=>{
    const color=q.type==='MCQ'?'#1A7A40':q.type==='Long Answer'?'#D4450A':'#A87020';
    const opts=q.options?q.options.map(o=>`<div style="padding:3px 0;color:${o.charAt(0)===q.answer?'#1A7A40':'#666'};font-weight:${o.charAt(0)===q.answer?700:400}">${o.charAt(0)===q.answer?'‚úì ':''}${o}</div>`).join(''):'';
    const hint=q.hint?`<div style="background:#faf6ee;border:1px solid rgba(168,112,32,0.2);border-radius:6px;padding:8px 12px;font-size:0.79rem;color:#A87020;margin-top:7px">üí≠ ${q.hint}</div>`:'';
    return `<div style="background:#faf6ee;border-radius:10px;padding:16px;margin-bottom:10px;border:1px solid #e8d5a0"><div style="display:flex;gap:8px;align-items:flex-start;margin-bottom:8px"><span style="border-radius:4px;padding:2px 8px;font-size:0.6rem;letter-spacing:1px;text-transform:uppercase;font-weight:700;border:1px solid ${color};color:${color};flex-shrink:0;margin-top:3px">${q.type}</span><span style="font-weight:600;line-height:1.6;font-size:0.92rem">Q${i+1}. ${q.question}</span></div>${opts}${hint}</div>`;
  }).join('');
  const bioImg = document.querySelector('.bio-photo');
  const bioImgHtml = bioImg?`<img src="${bioImg.src}" style="width:90px;height:90px;border-radius:10px;object-fit:cover;border:2px solid #C8860A;flex-shrink:0">`:
    `<div style="width:70px;height:70px;border-radius:10px;background:#f5e6c8;display:flex;align-items:center;justify-content:center;font-size:1.8rem">üë§</div>`;
  const bioHtml=(r.poetBio&&r.poetBio!=='N/A')?`<div style="background:#faf6ee;border:1px solid #e8d5a0;border-radius:12px;padding:18px;margin-bottom:20px;display:flex;gap:16px;align-items:flex-start">${bioImgHtml}<div><div style="font-family:'Cormorant Garamond',Georgia,serif;font-size:1.05rem;font-weight:700;color:#1A0E00;margin-bottom:6px">${r.poet}</div><div style="font-size:0.86rem;line-height:1.85;color:#5C3D10">${r.poetBio}</div></div></div>`:'';
  const lc=r.language==='Hindi'?'#D4450A':'#A87020';
  const html=`<!DOCTYPE html><html><head><meta charset="UTF-8"/><title>‡§ï‡§æ‡§µ‡•ç‡§Ø-‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§ï ‚Äî ${r.title}</title><link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,600;0,700;1,400&family=Tiro+Devanagari+Hindi&display=swap" rel="stylesheet"/><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Tiro Devanagari Hindi',Georgia,serif;color:#1A0E00;background:white;padding:32px 40px;font-size:11pt;line-height:1.6}h2{font-family:'Cormorant Garamond',Georgia,serif;font-size:1.1rem;font-weight:700;color:#A87020;margin:22px 0 12px;padding-bottom:9px;border-bottom:1px solid #e8d5a0}@media print{body{padding:14px 18px}@page{margin:1.4cm}}</style></head><body>
  <div style="text-align:center;padding-bottom:22px;border-bottom:2px solid #e8d5a0;margin-bottom:26px"><div style="font-size:1.8rem;margin-bottom:6px">ü™î</div><div style="font-family:'Cormorant Garamond',Georgia,serif;font-size:2.2rem;font-weight:700;color:#1A0E00">‡§ï‡§æ‡§µ‡•ç‡§Ø-‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§ï</div><div style="font-size:0.7rem;color:#A87020;letter-spacing:3px;text-transform:uppercase;margin-top:5px">Hindi & Marathi Poem Analyzer</div></div>
  <div style="background:linear-gradient(135deg,#faf6ee,#f5eedc);border:1px solid #e8d5a0;border-radius:12px;padding:20px 24px;margin-bottom:20px;display:flex;flex-wrap:wrap;gap:20px;align-items:flex-end"><div style="flex:1;min-width:130px"><div style="font-size:0.62rem;letter-spacing:2.5px;text-transform:uppercase;color:#A87020;margin-bottom:5px">‡§ï‡§µ‡§ø‡§§‡§æ ‡§∂‡•Ä‡§∞‡•ç‡§∑‡§ï</div><div style="font-family:'Cormorant Garamond',Georgia,serif;font-size:1.3rem;font-weight:700">${r.title}</div></div><div style="flex:1;min-width:130px"><div style="font-size:0.62rem;letter-spacing:2.5px;text-transform:uppercase;color:#A87020;margin-bottom:5px">‡§ï‡§µ‡•Ä / ‡§ï‡§µ‡§ø</div><div style="font-size:0.93rem">${r.poet}</div></div><div style="display:flex;gap:8px;flex-wrap:wrap"><span style="border-radius:5px;padding:4px 12px;font-size:0.68rem;letter-spacing:1px;text-transform:uppercase;font-weight:700;background:${lc}15;border:1px solid ${lc};color:${lc}">${r.language}</span><span style="border-radius:5px;padding:4px 12px;font-size:0.68rem;background:#f5f5f5;border:1px solid #ddd;color:#666">üéµ ${r.mood}</span></div></div>
  ${bioHtml}
  <h2>üìñ ‡§ï‡§µ‡§ø‡§§‡§æ ‡§ï‡§æ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂ / ‡§ï‡§µ‡§ø‡§§‡•á‡§ö‡§æ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂</h2><div style="margin-bottom:12px">${summary}</div><div style="margin-bottom:20px">${themes}</div>
  <h2>üí° ‡§ï‡§µ‡§ø ‡§ï‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ / ‡§ï‡§µ‡•Ä‡§ö‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂</h2><div style="border-left:3px solid #D4450A;padding:14px 20px;background:#faf6ee;border-radius:0 10px 10px 0;margin-bottom:20px">${message}</div>
  <h2>üé≠ ‡§ï‡§æ‡§µ‡•ç‡§Ø-‡§Ö‡§≤‡§Ç‡§ï‡§æ‡§∞ / Literary Devices</h2><div style="margin-bottom:20px">${devices}</div>
  <h2>üìù ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®</h2><div>${questions}</div>
  <div style="text-align:center;margin-top:32px;padding-top:14px;border-top:1px solid #e8d5a0;color:#bbb;font-size:0.72rem">ü™î ‡§ï‡§æ‡§µ‡•ç‡§Ø-‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§ï ¬∑ Powered by Google Gemini</div>
  <script>window.onload=function(){window.print();window.onafterprint=function(){window.close();};};<\/script></body></html>`;
  const w=window.open('','_blank');w.document.write(html);w.document.close();
}

// ‚îÄ‚îÄ SHARE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function shareResult() {
  const url = window.location.href;
  if (navigator.share) {
    navigator.share({title:'‡§ï‡§æ‡§µ‡•ç‡§Ø-‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§ï',text:'üìñ Poem Analysis',url});
  } else {
    navigator.clipboard.writeText(url).then(()=>{
      const b=document.getElementById('shareBtn');
      const o=b.innerHTML;b.textContent='‚úÖ Copied!';
      setTimeout(()=>b.innerHTML=o,2000);
    });
  }
}

// ‚îÄ‚îÄ COPY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function copyPanel(id,e) {
  const el=document.getElementById(id);
  navigator.clipboard.writeText(el?el.innerText:'').then(()=>showCopy(e.currentTarget));
}
function copyAll() {
  if(!currentResult)return;
  const r=currentResult;
  const t=`‡§ï‡§æ‡§µ‡•ç‡§Ø-‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§ï\n${'‚îÄ'.repeat(40)}\nTitle: ${r.title}\nPoet: ${r.poet}\nLanguage: ${r.language}\nMood: ${r.mood}\n\nSummary:\n${r.summary}\n\nMessage:\n${r.poetMessage}\n\nThemes: ${(r.themes||[]).join(', ')}\n\nLiterary Devices:\n${(r.literaryDevices||[]).join('\n')}\n\nExam Questions:\n${(r.examQuestions||[]).map((q,i)=>`Q${i+1}.[${q.type}] ${q.question}`).join('\n')}`;
  navigator.clipboard.writeText(t).then(()=>showCopy(document.getElementById('copyBtn')));
}
function showCopy(btn){
  const o=btn.innerHTML;btn.textContent='‚úÖ Copied!';btn.classList.add('copied');
  setTimeout(()=>{btn.innerHTML=o;btn.classList.remove('copied');},2000);
}

// ‚îÄ‚îÄ DRAWER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openDrawer(){document.getElementById('drawer').classList.add('open');document.getElementById('overlay').classList.add('open');document.body.style.overflow='hidden';}
function closeDrawer(){document.getElementById('drawer').classList.remove('open');document.getElementById('overlay').classList.remove('open');document.body.style.overflow='';}

// ‚îÄ‚îÄ RECENTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getRecents(){try{return JSON.parse(localStorage.getItem('kavya_recents')||'[]');}catch(e){return[];}}
function saveToRecents(r,poem){
  let rc=getRecents();
  rc=rc.filter(x=>x.title!==r.title);
  rc.unshift({id:Date.now(),title:r.title,poet:r.poet,language:r.language,poem,date:new Date().toLocaleDateString('en-IN'),data:r});
  if(rc.length>MAX_RECENTS)rc=rc.slice(0,MAX_RECENTS);
  localStorage.setItem('kavya_recents',JSON.stringify(rc));
  renderRecents();
}
function renderRecents(){
  const rc=getRecents();
  document.getElementById('recentsCount').textContent=rc.length;
  const list=document.getElementById('drawerList');
  if(!rc.length){list.innerHTML='<div class="drawer-empty">No poems analyzed yet.<br/>‡§Ö‡§≠‡•Ä ‡§§‡§ï ‡§ï‡•ã‡§à ‡§ï‡§µ‡§ø‡§§‡§æ ‡§®‡§π‡•Ä‡§Ç‡•§</div>';return;}
  list.innerHTML=rc.map((item,i)=>`
    <div class="r-item" onclick="loadRecent(${i})">
      <div class="r-item-info">
        <div class="r-item-title">${item.title}</div>
        <div class="r-item-meta">${item.poet} ¬∑ ${item.date}</div>
      </div>
      <span class="r-badge ${item.language==='Hindi'?'r-badge-hi':'r-badge-mr'}">${item.language}</span>
      <span class="r-arrow">‚Ä∫</span>
    </div>`).join('');
}
function loadRecent(i){
  const item=getRecents()[i];if(!item)return;
  closeDrawer();
  document.getElementById('poem').value=item.poem;
  render(item.data);
  document.getElementById('refreshBtn').style.display='flex';
  setTimeout(()=>document.getElementById('result').scrollIntoView({behavior:'smooth'}),400);
}
function clearRecents(){if(!confirm('Clear all recents?'))return;localStorage.removeItem('kavya_recents');renderRecents();}

// ‚îÄ‚îÄ RESET ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function resetPage(){
  document.getElementById('poem').value='';
  document.getElementById('result').style.display='none';
  document.getElementById('err').style.display='none';
  document.getElementById('refreshBtn').style.display='none';
  currentResult=null;
  document.getElementById('poem').focus();
  window.scrollTo({top:0,behavior:'smooth'});
}

// ‚îÄ‚îÄ TABS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function tab(name,el){
  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(t=>t.classList.remove('active'));
  document.getElementById('p-'+name).classList.add('active');
  el.classList.add('active');
}

// ‚îÄ‚îÄ ANALYZE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function analyze(){
  const poem=document.getElementById('poem').value.trim();
  const btn=document.getElementById('btn');
  if(!poem){showErr('‡§ï‡§µ‡§ø‡§§‡§æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç / Please enter a poem');return;}
  document.getElementById('err').style.display='none';
  document.getElementById('result').style.display='none';
  btn.disabled=true;
  btn.innerHTML='<span class="spinner"></span> ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...';
  try{
    const res=await fetch('https://kavya-api.amanchougule1381.workers.dev',
      {method:'POST',headers:{'Content-Type':'application/json'},
       body:JSON.stringify({contents:[{parts:[{text:PROMPT+'\n\nPoem:\n\n'+poem}]}],generationConfig:{temperature:0.2,maxOutputTokens:8192},tools:[{googleSearch:{}}]})});
    if(!res.ok){const e=await res.json().catch(()=>({}));throw new Error('Error '+res.status+': '+(e?.error?.message||JSON.stringify(e)));}
    const data=await res.json();
    const text=data.candidates?.[0]?.content?.parts?.[0]?.text||'';
    const clean=text.replace(/^```(?:json)?\s*/i,'').replace(/\s*```$/i,'').trim();
    let parsed;try{parsed=JSON.parse(clean);}catch(pe){throw new Error('Could not read response. Please try again.');}
    render(parsed);saveToRecents(parsed,poem);
    clearChat(); chatHistory = [];
    document.getElementById('refreshBtn').style.display='flex';
  }catch(e){showErr(e.message);}
  finally{btn.disabled=false;btn.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg> ‡§ï‡§µ‡§ø‡§§‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡•á‡§Ç / ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡§æ';}
}
function showErr(msg){const e=document.getElementById('err');e.textContent='‚ùå '+msg;e.style.display='block';}

// ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function render(r){
  currentResult=r;
  document.getElementById('r-title').textContent=r.title||'';
  document.getElementById('r-poet').textContent=r.poet||'';
  document.getElementById('r-toolbar-title').textContent=r.title||'';
  const lang=document.getElementById('r-lang');
  lang.textContent=r.language||'';lang.className='badge '+(r.language==='Hindi'?'badge-hi':'badge-mr');
  document.getElementById('r-mood').textContent=r.mood?'üéµ '+r.mood:'';

  const bioCard=document.getElementById('bioCard');
  if(r.poetBio&&r.poetBio!=='N/A'&&r.poet&&r.poet!=='‡§Ö‡§ú‡•ç‡§û‡§æ‡§§ ‡§ï‡§µ‡•Ä'){
    document.getElementById('bio-name').textContent=r.poet;
    document.getElementById('bio-text').textContent=r.poetBio;
    const pw=document.getElementById('bioPhotoWrap');
    pw.innerHTML='<div class="bio-placeholder" id="bioPhotoPlaceholder">üë§</div>';
    fetchPoetPhoto(r.poetNameEnglish&&r.poetNameEnglish!=='N/A'?r.poetNameEnglish:r.poet);
    bioCard.style.display='flex';
  }else{bioCard.style.display='none';}

  document.getElementById('r-summary').innerHTML=(r.summary||'').split('\n').filter(p=>p.trim()).map(p=>`<p>${p}</p>`).join('');
  document.getElementById('r-message').innerHTML=(r.poetMessage||'').split('\n').filter(p=>p.trim()).map(p=>`<p style="font-style:italic">${p}</p>`).join('');
  document.getElementById('r-themes').innerHTML=(r.themes||[]).map(t=>`<span class="theme-tag">${t}</span>`).join('');
  document.getElementById('r-devices').innerHTML=(r.literaryDevices||[]).map(d=>`<div class="device">${d}</div>`).join('');
  document.getElementById('r-questions').innerHTML=(r.examQuestions||[]).map((q,i)=>{
    const tc=q.type==='MCQ'?'qt-mcq':q.type==='Long Answer'?'qt-la':'qt-sa';
    const opts=q.options?`<div class="q-options">${q.options.map(o=>`<div class="q-option ${o.charAt(0)===q.answer?'correct':''}">${o.charAt(0)===q.answer?'‚úì ':''}${o}</div>`).join('')}</div>`:'';
    const hint=q.hint?`<div class="q-hint">üí≠ ${q.hint}</div>`:'';
    return `<div class="question"><div class="q-head"><span class="q-type-badge ${tc}">${q.type}</span><span class="q-text">Q${i+1}. ${q.question}</span></div>${opts}${hint}</div>`;
  }).join('');

  document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(t=>t.classList.remove('active'));
  document.getElementById('p-summary').classList.add('active');
  document.querySelectorAll('.tab-btn')[0].classList.add('active');
  document.getElementById('result').style.display='block';
  document.getElementById('result').scrollIntoView({behavior:'smooth'});
}

// ‚îÄ‚îÄ POET PHOTO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function fetchPoetPhoto(poetName){
  const clean=poetName.replace(/[()‡•§]/g,'').trim();
  function setPhoto(url){
    const el=document.getElementById('bioPhotoPlaceholder');if(!el)return;
    const img=document.createElement('img');img.className='bio-photo';img.src=url;img.alt=poetName;
    img.onerror=()=>img.remove();el.replaceWith(img);
  }
  async function photoByTitle(lang,title){
    try{const r=await fetch(`https://${lang}.wikipedia.org/w/api.php?action=query&titles=${encodeURIComponent(title)}&prop=pageimages&format=json&pithumbsize=400&origin=*`);const d=await r.json();const page=Object.values(d.query.pages)[0];return page?.thumbnail?.source||null;}catch(e){return null;}
  }
  async function searchTitle(lang,query){
    try{const r=await fetch(`https://${lang}.wikipedia.org/w/api.php?action=opensearch&search=${encodeURIComponent(query)}&limit=3&format=json&origin=*`);const d=await r.json();return d[1]||[];}catch(e){return[];}
  }
  try{
    for(const lang of['en','hi','mr']){
      let photo=await photoByTitle(lang,clean);if(photo){setPhoto(photo);return;}
      const titles=await searchTitle(lang,clean);
      for(const title of titles){photo=await photoByTitle(lang,title);if(photo){setPhoto(photo);return;}}
    }
    const tp=await searchTitle('en',clean+' Indian poet');
    for(const title of tp){const photo=await photoByTitle('en',title);if(photo){setPhoto(photo);return;}}
  }catch(e){}
}

// ‚îÄ‚îÄ CHAT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let chatHistory = [];
let chatBusy = false;

function autoResize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 120) + 'px';
}

function handleChatKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendChat(); }
}

function sendSuggestion(btn) {
  document.getElementById('chatInput').value = btn.textContent;
  sendChat();
}

function clearChat() {
  chatHistory = [];
  const msgs = document.getElementById('chatMessages');
  msgs.innerHTML = `
    <div class="chat-welcome">
      <div class="chat-welcome-icon">ü§ñ</div>
      <div class="chat-welcome-title">AI Poetry Assistant</div>
      <div class="chat-welcome-sub">‡§ï‡§µ‡§ø‡§§‡§æ ‡§ï‡•á ‡§¨‡§æ‡§∞‡•á ‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§õ ‡§≠‡•Ä ‡§™‡•Ç‡§õ‡•á‡§Ç ‚Äî ‡§Ö‡§∞‡•ç‡§•, ‡§≠‡§æ‡§µ, ‡§á‡§§‡§ø‡§π‡§æ‡§∏, ‡§Ø‡§æ ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§∏‡•á ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§™‡•ç‡§∞‡§∂‡•ç‡§®</div>
      <div class="chat-suggestions">
        <button class="suggestion-chip" onclick="sendSuggestion(this)">‡§á‡§∏ ‡§ï‡§µ‡§ø‡§§‡§æ ‡§ï‡§æ ‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?</button>
        <button class="suggestion-chip" onclick="sendSuggestion(this)">‡§ï‡§µ‡§ø ‡§®‡•á ‡§á‡§∏‡•á ‡§ï‡•ç‡§Ø‡•ã‡§Ç ‡§≤‡§ø‡§ñ‡§æ?</button>
        <button class="suggestion-chip" onclick="sendSuggestion(this)">‡§á‡§∏ ‡§ï‡§µ‡§ø‡§§‡§æ ‡§Æ‡•á‡§Ç ‡§ï‡•å‡§® ‡§∏‡•á ‡§Ö‡§≤‡§Ç‡§ï‡§æ‡§∞ ‡§π‡•à‡§Ç?</button>
        <button class="suggestion-chip" onclick="sendSuggestion(this)">Explain the first stanza in detail</button>
      </div>
    </div>`;
}

function appendBubble(role, text) {
  const msgs = document.getElementById('chatMessages');
  // Remove welcome screen on first message
  const welcome = msgs.querySelector('.chat-welcome');
  if (welcome) welcome.remove();

  const time = new Date().toLocaleTimeString('en-IN', {hour:'2-digit', minute:'2-digit'});
  const div = document.createElement('div');
  div.className = `chat-bubble ${role}`;

  if (role === 'user') {
    div.innerHTML = `
      <div class="bubble-avatar user-av">üôã</div>
      <div>
        <div class="bubble-content">${text.replace(/\n/g,'<br>')}</div>
        <div class="bubble-time">${time}</div>
      </div>`;
  } else {
    // Format AI response: bold **text**, line breaks
    const formatted = text
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      .replace(/\n/g, '<br>');
    div.innerHTML = `
      <div class="bubble-avatar ai-av">AI</div>
      <div>
        <div class="bubble-content">${formatted}</div>
        <div class="bubble-time">${time}</div>
      </div>`;
  }
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
  return div;
}

function showTyping() {
  const msgs = document.getElementById('chatMessages');
  const div = document.createElement('div');
  div.className = 'typing-indicator';
  div.id = 'typingIndicator';
  div.innerHTML = `
    <div class="bubble-avatar ai-av">AI</div>
    <div class="typing-dots">
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
      <div class="typing-dot"></div>
    </div>`;
  msgs.appendChild(div);
  msgs.scrollTop = msgs.scrollHeight;
}

function removeTyping() {
  const t = document.getElementById('typingIndicator');
  if (t) t.remove();
}

async function sendChat() {
  if (chatBusy) return;
  if (!currentResult) { alert('Please analyze a poem first, then ask questions.'); return; }

  const input = document.getElementById('chatInput');
  const question = input.value.trim();
  if (!question) return;

  input.value = '';
  input.style.height = 'auto';
  chatBusy = true;
  document.getElementById('chatSendBtn').disabled = true;

  // Show user bubble
  appendBubble('user', question);

  // Add to history
  chatHistory.push({ role: 'user', content: question });

  // Show typing
  showTyping();

  // Build system context with poem info
  const poemContext = `You are an expert literary scholar for Hindi and Marathi poetry.
The user is asking about this specific poem:

Title: ${currentResult.title}
Poet: ${currentResult.poet}
Language: ${currentResult.language}
Poem text: ${document.getElementById('poem').value}

Analysis already done:
Summary: ${currentResult.summary}
Poet's Message: ${currentResult.poetMessage}
Themes: ${(currentResult.themes||[]).join(', ')}
Literary Devices: ${(currentResult.literaryDevices||[]).join(' | ')}

Answer the user's question in the SAME language as the poem (${currentResult.language}).
Be detailed, accurate, and educational. Use examples from the poem when relevant.
Keep answers clear and helpful for students.`;

  // Build messages for API (system context + full history)
  const messages = [
    { role: 'user', content: poemContext + '\n\n---\n\nNow answer this question: ' + chatHistory[0].content }
  ];
  // Add subsequent turns
  for (let i = 1; i < chatHistory.length; i++) {
    messages.push(chatHistory[i]);
  }
  // If first message, messages already has it; else rebuild correctly
  const apiMessages = chatHistory.length === 1
    ? [{ role: 'user', content: poemContext + '\n\nQuestion: ' + question }]
    : [
        { role: 'user', content: poemContext + '\n\nFirst question: ' + chatHistory[0].content },
        ...chatHistory.slice(1).map((m, i) => ({
          role: i % 2 === 0 ? 'model' : 'user',
          content: m.content
        }))
      ];

  // Build Gemini contents array
  const contents = apiMessages.map(m => ({
    role: m.role === 'model' ? 'model' : 'user',
    parts: [{ text: m.content }]
  }));

  try {
    const res = await fetch('https://kavya-api.amanchougule1381.workers.dev', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        contents,
        generationConfig: { temperature: 0.3, maxOutputTokens: 2048 }
      })
    });
    if (!res.ok) throw new Error('API error ' + res.status);
    const data = await res.json();
    const answer = data.candidates?.[0]?.content?.parts?.[0]?.text || 'Sorry, could not get an answer. Please try again.';

    removeTyping();
    appendBubble('ai', answer);

    // Add AI response to history
    chatHistory.push({ role: 'model', content: answer });

  } catch(e) {
    removeTyping();
    appendBubble('ai', '‚ùå Error: ' + e.message);
  } finally {
    chatBusy = false;
    document.getElementById('chatSendBtn').disabled = false;
    input.focus();
  }
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const savedTheme=localStorage.getItem('kavya_theme')||'light';
document.documentElement.setAttribute('data-theme',savedTheme);
if(savedTheme==='dark'){
  document.getElementById('darkBtn').innerHTML=`<svg viewBox="0 0 24 24" width="13" height="13" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg> Light`;
  document.getElementById('darkBtn').classList.add('active');
}
renderRecents();
</script>
</body>
</html>
